name: TestConnection

on:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    environment: development

    steps:
      - name: Check if SSH key exists
        run: |
          if [ -z "${{ secrets.SSH_KEY }}" ]; then
            echo "âŒ SSH_KEY secret is empty!"
            exit 1
          else
            echo "âœ” SSH_KEY secret is set."
          fi

      - name: Write SSH key to temp file
        run: |
          echo "${{ secrets.SSH_KEY }}" > testkey
          chmod 600 testkey
          echo "âœ” Key written to temporary file."

      - name: Check if key is encrypted or valid
        run: |
          echo "ğŸ” Running ssh-keygen fingerprint check..."
          ssh-keygen -l -f testkey || echo "âŒ ssh-keygen failed (invalid key format)"

      - name: Test if ssh-agent can load key
        run: |
          eval "$(ssh-agent -s)"
          ssh-add testkey && echo "âœ” Key successfully loaded into ssh-agent" \
            || echo "âŒ Key could NOT be loaded into ssh-agent (likely ENCRYPTED or INVALID)"

      - name: Cleanup
        run: rm testkey
  
